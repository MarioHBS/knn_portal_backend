# REGRAS PARA CRIAÇÃO DE ID DE PARCEIROS

## ESTRUTURA DO ID DO PARCEIRO

O ID do parceiro segue o padrão: **PTN_[INICIAIS_INTERCALADAS_COM_DÍGITOS_CNPJ]_[CATEGORIA]**

### COMPRIMENTO FIXO

15 caracteres

### COMPONENTES DO ID

1. **Prefixo Padrão**: `PTN` (Partner)
2. **Seção Central**: Iniciais do nome comercial intercaladas com dígitos do CNPJ
3. **Sufixo**: Código da categoria do parceiro

---

## ALGORITMO PARA SEÇÃO CENTRAL

### EXTRAÇÃO DAS INICIAIS

1. Extrair as iniciais do nome comercial (trade_name)
2. Considerar apenas letras maiúsculas
3. Ignorar preposições, artigos e conectivos (de, da, do, das, dos, e, &, and, etc.)
4. Máximo de 4 iniciais
5. Se houver menos de 4 iniciais, usar apenas as disponíveis

### INTERCALAÇÃO COM DÍGITOS DO CNPJ

1. Calcular quantos dígitos são necessários para atingir 15 caracteres totais
2. Extrair os últimos N dígitos do primeiro grupo do CNPJ (antes da barra "/")
3. Intercalar as iniciais com esses dígitos na ordem
4. Formato: INICIAL + DÍGITO_CNPJ + INICIAL + DÍGITO_CNPJ...

### EXEMPLOS DE INTERCALAÇÃO

**Exemplo detalhado:**

- **Restaurante Sabor & Arte** (CNPJ: 23456789000186)
- Iniciais: RSA (ignorar "&")
- Formato base: PTN_RSA_ALM = 11 caracteres
- Faltam: 15 - 11 = 4 caracteres
- Últimos 4 dígitos do 1º grupo: 6789
- **Resultado: PTN_R6S7A89_ALM**

**Outros exemplos:**

- "McDonald's" (CNPJ: 12345678000199) → PTN_M12345678_ALM
- "Livraria Cultura" (CNPJ: 98765432000155) → PTN_L9C8765432_EDU

---

## CÓDIGOS DE CATEGORIA

### CATEGORIAS PRINCIPAIS

- **ALM**: Alimentação
- **ENT**: Entretenimento
- **EDU**: Educação
- **SAU**: Saúde e Bem-estar
- **TEC**: Tecnologia
- **MOD**: Moda e Vestuário
- **LIV**: Livraria
- **ESP**: Esportes
- **BEL**: Beleza
- **TUR**: Turismo e Viagem
- **AUT**: Automotivo
- **FIN**: Financeiro
- **SER**: Serviços Gerais
- **VAR**: Varejo
- **OUT**: Outros

### MAPEAMENTO DE CATEGORIAS

- "Alimentação" → ALM
- "Entretenimento" → ENT
- "Educação" → EDU
- "Saúde e Bem-estar" → SAU
- "Tecnologia" → TEC
- "Moda" → MOD
- "Livraria" → LIV
- "Esportes" → ESP
- "Beleza" → BEL
- "Turismo" → TUR
- "Automotivo" → AUT
- "Financeiro" → FIN
- "Serviços" → SER
- "Varejo" → VAR

---

## EXEMPLOS COMPLETOS DE IDs

### EXEMPLOS BASEADOS NOS DADOS DE TESTE

1. **McDonald's** (Alimentação) - CNPJ: 12345678000199
   - Iniciais: M
   - Caracteres necessários: 15 - 11 = 4
   - Últimos 4 dígitos do 1º grupo: 5678
   - **ID Final: PTN_M5678_ALM** (11 chars) → **PTN_M12345678_ALM** (15 chars)

2. **Restaurante Sabor & Arte** (Alimentação) - CNPJ: 23456789000186
   - Iniciais: RSA
   - Caracteres necessários: 15 - 11 = 4
   - Últimos 4 dígitos do 1º grupo: 6789
   - **ID Final: PTN_R6S7A89_ALM** (15 chars)

3. **Livraria Cultura** (Educação) - CNPJ: 98765432000155
   - Iniciais: LC
   - Caracteres necessários: 15 - 10 = 5
   - Últimos 5 dígitos do 1º grupo: 65432
   - **ID Final: PTN_L6C5432_EDU** (15 chars)

4. **Academia Smart Fit** (Saúde) - CNPJ: 11223344000177
   - Iniciais: ASF
   - Caracteres necessários: 15 - 11 = 4
   - Últimos 4 dígitos do 1º grupo: 3344
   - **ID Final: PTN_A3S4F4_SAU** (15 chars)

---

## REGRAS DE VALIDAÇÃO

### FORMATO GERAL

- Padrão regex: `^PTN_[A-Z0-9]{7}_[A-Z]{3}$`
- Comprimento fixo: 15 caracteres
- Seção central: exatamente 7 caracteres (iniciais + dígitos CNPJ)

### VALIDAÇÕES OBRIGATÓRIAS

1. Prefixo deve ser exatamente "PTN"
2. Seção central deve ter exatamente 7 caracteres
3. Categoria deve ser um código válido de 3 letras
4. Todos os caracteres alfabéticos devem estar em maiúsculo
5. Dígitos devem vir dos últimos dígitos do 1º grupo do CNPJ
6. Comprimento total deve ser exatamente 15 caracteres

### TRATAMENTO DE CASOS ESPECIAIS

- Nomes com caracteres especiais: remover acentos e símbolos
- Nomes muito curtos: usar todas as iniciais disponíveis
- Nomes muito longos: usar apenas as 4 primeiras iniciais válidas
- Categorias não mapeadas: usar código "OUT" (Outros)

---

## ALGORITMO DE IMPLEMENTAÇÃO

```python
def gerar_id_parceiro(trade_name: str, category: str, cnpj: str) -> str:
    # 1. Extrair iniciais do nome comercial
    iniciais = extrair_iniciais(trade_name)
    
    # 2. Calcular dígitos necessários para 15 caracteres
    codigo_categoria = mapear_categoria(category)
    base_length = len(f"PTN__{codigo_categoria}")  # 8 chars
    digitos_necessarios = 15 - base_length - len(iniciais)
    
    # 3. Extrair últimos N dígitos do 1º grupo do CNPJ
    primeiro_grupo = cnpj.split('/')[0].replace('.', '')
    digitos_cnpj = primeiro_grupo[-digitos_necessarios:]
    
    # 4. Intercalar iniciais com dígitos do CNPJ
    secao_central = intercalar_iniciais_com_cnpj(iniciais, digitos_cnpj)
    
    # 5. Construir ID final (sempre 15 caracteres)
    return f"PTN_{secao_central}_{codigo_categoria}"
```

---

## CONSIDERAÇÕES TÉCNICAS

### UNICIDADE

- O ID deve ser único dentro do tenant
- Em caso de conflito, adicionar sufixo numérico: PTN_M1_ALM_2
- Verificar unicidade antes da criação

### PERFORMANCE

- Indexar campo ID para consultas rápidas
- Considerar cache para validação de unicidade
- Otimizar regex para validação em lote

### MANUTENIBILIDADE

- Manter mapeamento de categorias em configuração
- Permitir adição de novas categorias sem alteração de código
- Documentar mudanças no formato do ID

---

## HISTÓRICO DE VERSÕES

- **v1.0** (2024-01-20): Versão inicial das regras
- Baseado nos padrões de IDs de alunos (STD_) e funcionários (EMP_)
- Adaptado para características específicas de parceiros comerciais